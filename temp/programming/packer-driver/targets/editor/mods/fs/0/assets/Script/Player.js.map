{"version":3,"sources":["file:///Users/backup/SnowyDay/SnowyDay/assets/Script/Player.ts"],"names":["_decorator","Component","Node","tween","v3","ParticleSystem2D","RigidBody2D","Vec2","ccclass","property","Player","onLoad","node","on","fireToPosition","rigidBody","getComponent","update","dt","position","force","nodePos","getPosition","currentPos","x","y","currentAngle","Math","atan2","PI","cos","sin","fireBullet","linearVelocity","applyForceToCenter","callBack","bullet","setPosition","resetSystem","active","tweenMove","stop","to","easing","delay","call","reset","start","stopSystem"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, tween, v3, Vec3, ParticleSystem2D, RigidBody2D, Vec2 } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Player')\nexport class Player extends Component {\n\n    @property(Node)\n    bullet: Node;\n\n    tweenMove: any;\n    rigidBody: RigidBody2D;\n    onLoad() {\n        this.node.on(\"FIRE_TO_POS\", this.fireToPosition, this);\n        this.rigidBody = this.node.getComponent(RigidBody2D);\n    }\n    update(dt) {\n\n    }\n\n    fireToPosition(position, force) {\n        const nodePos = this.node.getPosition();\n        const currentPos = new Vec2(nodePos.x - position.x, nodePos.y - position.y);\n        const currentAngle = Math.atan2(currentPos.y, currentPos.x) * 180 / Math.PI;\n        const x = force * Math.cos((currentAngle * Math.PI) / 180);\n        const y = force * Math.sin((currentAngle * Math.PI) / 180);\n\n        this.fireBullet(position);\n        this.rigidBody.linearVelocity = new Vec2(0, 0);\n        this.rigidBody.applyForceToCenter(new Vec2(x, y), true);\n    }\n\n    fireBullet(position, callBack = null) {\n        this.bullet.setPosition(this.node.getPosition());\n        this.bullet.getComponent(ParticleSystem2D).resetSystem();\n        this.bullet.active = true;\n        this.tweenMove && this.tweenMove.stop();\n        this.tweenMove = tween(this.bullet)\n            .to(0.3, { position: v3(position) }, { easing: 'sineInOut' })\n            .delay(0.1)\n            .call(() => {\n                callBack && callBack();\n                this.reset();\n                this.tweenMove = null;\n            })\n            .start();\n    }\n    reset() {\n        this.bullet.getComponent(ParticleSystem2D).resetSystem();\n        this.bullet.getComponent(ParticleSystem2D).stopSystem();\n    }\n}\n"]}