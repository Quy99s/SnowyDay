{"version":3,"sources":["file:///Users/backup/SnowyDay/SnowyDay/assets/Script/MainGameControler.ts"],"names":["Component","_decorator","Node","UITransform","Vec3","CCString","ccclass","property","MainGameControler","onLoad","panel","active","bindClickEvent","node","on","fire","update","deltaTime","gameArea","EventType","TOUCH_START","onTouchStart","bind","TOUCH_END","onTouchCancel","TOUCH_MOVE","onTouchMove","TOUCH_CANCEL","event","location","getLocation","touchPos","x","y","touchPoint","setPosition","kine","player","emit","getPosition","bulletForce","isInGameArea","pos","szBg","getComponent","contentSize","width","height"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,S,OAAAA,S;AAAWC,MAAAA,U,OAAAA,U;AAAYC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,W,OAAAA,W;AAAyBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,Q,OAAAA,Q;;;;;;;OAE/D;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;mCAGjBO,iB,WADZF,OAAO,CAAC,mBAAD,C,UAGHC,QAAQ,CAACL,IAAD,C,UAGRK,QAAQ,CAACL,IAAD,C,UAGRK,QAAQ,CAACL,IAAD,C,UAGRK,QAAQ,CAACL,IAAD,C,UAGRK,QAAQ,CAACF,QAAD,C,oCAfb,MACaG,iBADb,SACuCR,SADvC,CACiD;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AAiB7CS,QAAAA,MAAM,GAAG;AACL,eAAKC,KAAL,CAAWC,MAAX,GAAoB,KAApB;AACA,eAAKC,cAAL;AACA,eAAKC,IAAL,CAAUC,EAAV,CAAa,MAAb,EAAqB,KAAKC,IAA1B,EAAgC,IAAhC;AACH;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CACtB;AACA;AACA;AACH;;AACDL,QAAAA,cAAc,GAAG;AACb,cAAI,KAAKM,QAAT,EAAmB;AACf,iBAAKA,QAAL,CAAcJ,EAAd,CAAiBZ,IAAI,CAACiB,SAAL,CAAeC,WAAhC,EAA6C,KAAKC,YAAL,CAAkBC,IAAlB,CAAuB,IAAvB,CAA7C;AACA,iBAAKJ,QAAL,CAAcJ,EAAd,CAAiBZ,IAAI,CAACiB,SAAL,CAAeI,SAAhC,EAA2C,KAAKC,aAAL,CAAmBF,IAAnB,CAAwB,IAAxB,CAA3C;AACA,iBAAKJ,QAAL,CAAcJ,EAAd,CAAiBZ,IAAI,CAACiB,SAAL,CAAeM,UAAhC,EAA4C,KAAKC,WAAL,CAAiBJ,IAAjB,CAAsB,IAAtB,CAA5C;AACA,iBAAKJ,QAAL,CAAcJ,EAAd,CAAiBZ,IAAI,CAACiB,SAAL,CAAeQ,YAAhC,EAA8C,KAAKH,aAAL,CAAmBF,IAAnB,CAAwB,IAAxB,CAA9C;AACH;AACJ;;AACDD,QAAAA,YAAY,CAACO,KAAD,EAAoB,CAC5B;AACH;;AACDJ,QAAAA,aAAa,CAACI,KAAD,EAAoB;AAC7B,gBAAMC,QAAQ,GAAGD,KAAK,CAACE,WAAN,EAAjB;AACA,gBAAMC,QAAQ,GAAG,IAAI3B,IAAJ,CAASyB,QAAQ,CAACG,CAAT,GAAa,GAAtB,EAA2BH,QAAQ,CAACI,CAAT,GAAa,GAAxC,CAAjB;AACA,eAAKC,UAAL,CAAgBC,WAAhB,CAA4BJ,QAA5B,EAH6B,CAI7B;AACH;;AACDhB,QAAAA,IAAI,CAACqB,IAAD,EAAO;AACP,eAAKC,MAAL,CAAYC,IAAZ,CAAiB,aAAjB,EAAgC,KAAKJ,UAAL,CAAgBK,WAAhB,EAAhC,EAA+D,KAAKC,WAApE,EAAiFJ,IAAjF;AACH;;AACDV,QAAAA,WAAW,CAACE,KAAD,EAAoB;AAC3B,gBAAMC,QAAQ,GAAGD,KAAK,CAACE,WAAN,EAAjB;AACA,gBAAMC,QAAQ,GAAG,IAAI3B,IAAJ,CAASyB,QAAQ,CAACG,CAAT,GAAa,GAAtB,EAA2BH,QAAQ,CAACI,CAAT,GAAa,GAAxC,CAAjB;AACA,eAAKC,UAAL,CAAgBC,WAAhB,CAA4BJ,QAA5B,EAH2B,CAK3B;AACH;;AAGDU,QAAAA,YAAY,CAACC,GAAD,EAAW;AACnB,cAAIC,IAAI,GAAG,KAAKzB,QAAL,CAAc0B,YAAd,CAA2BzC,WAA3B,EAAwC0C,WAAnD;;AACA,cAAIH,GAAG,CAACV,CAAJ,IAAS,CAACW,IAAI,CAACG,KAAN,GAAc,CAA3B,EAA8B;AAC1B,mBAAO,KAAP;AACH;;AACD,cAAIJ,GAAG,CAACV,CAAJ,IAASW,IAAI,CAACG,KAAL,GAAa,CAA1B,EAA6B;AACzB,mBAAO,KAAP;AACH;;AACD,cAAIJ,GAAG,CAACT,CAAJ,IAAS,CAACU,IAAI,CAACI,MAAN,GAAe,CAA5B,EAA+B;AAC3B,mBAAO,KAAP;AACH;;AACD,cAAIL,GAAG,CAACT,CAAJ,IAASU,IAAI,CAACI,MAAL,GAAc,CAA3B,EAA8B;AAC1B,mBAAO,KAAP;AACH;;AACD,iBAAO,IAAP;AACH;;AAxE4C,O;;;;;;;;;;;;;;;;;;;;;;;;;iBAevB,K","sourcesContent":["import { Component, _decorator, Node, UITransform, EventTouch, Vec3, CCString } from \"cc\";\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('MainGameControler')\nexport class MainGameControler extends Component {\n\n    @property(Node)\n    gameArea: Node;\n\n    @property(Node)\n    player: Node;\n\n    @property(Node)\n    panel: Node;\n\n    @property(Node)\n    touchPoint: Node;\n\n    @property(CCString)\n    bulletForce: String = '500';\n\n    onLoad() {\n        this.panel.active = false;\n        this.bindClickEvent();\n        this.node.on(\"FIRE\", this.fire, this);\n    }\n\n    update(deltaTime: number) {\n        // if (!this.isInGameArea(this.player.getPosition())) {\n        //     this.panel.active = true;\n        // }\n    }\n    bindClickEvent() {\n        if (this.gameArea) {\n            this.gameArea.on(Node.EventType.TOUCH_START, this.onTouchStart.bind(this));\n            this.gameArea.on(Node.EventType.TOUCH_END, this.onTouchCancel.bind(this));\n            this.gameArea.on(Node.EventType.TOUCH_MOVE, this.onTouchMove.bind(this));\n            this.gameArea.on(Node.EventType.TOUCH_CANCEL, this.onTouchCancel.bind(this));\n        }\n    }\n    onTouchStart(event: EventTouch) {\n        // console.warn(\"onTouchStart\", event);\n    }\n    onTouchCancel(event: EventTouch) {\n        const location = event.getLocation();\n        const touchPos = new Vec3(location.x - 480, location.y - 320);\n        this.touchPoint.setPosition(touchPos);\n        // console.warn(\"onTouchCancel\", event);\n    }\n    fire(kine) {\n        this.player.emit('FIRE_TO_POS', this.touchPoint.getPosition(), this.bulletForce, kine);\n    }\n    onTouchMove(event: EventTouch) {\n        const location = event.getLocation();\n        const touchPos = new Vec3(location.x - 480, location.y - 320);\n        this.touchPoint.setPosition(touchPos);\n\n        // console.warn(\"onTouchMove\", event);\n    }\n\n\n    isInGameArea(pos: any) {\n        let szBg = this.gameArea.getComponent(UITransform).contentSize;\n        if (pos.x <= -szBg.width / 2) {\n            return false;\n        }\n        if (pos.x >= szBg.width / 2) {\n            return false;\n        }\n        if (pos.y <= -szBg.height / 2) {\n            return false;\n        }\n        if (pos.y >= szBg.height / 2) {\n            return false;\n        }\n        return true;\n    }\n\n}\n\n\n"]}