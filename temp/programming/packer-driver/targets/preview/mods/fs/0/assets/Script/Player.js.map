{"version":3,"sources":["file:///Users/backup/SnowyDay/SnowyDay/assets/Script/Player.ts"],"names":["_decorator","Component","Node","tween","v3","ParticleSystem2D","RigidBody2D","Vec2","ccclass","property","Player","onLoad","node","on","fireToPosition","rigidBody","getComponent","update","dt","position","nodePos","getPosition","currentPos","x","y","currentAngle","Math","atan2","PI","force","cos","sin","fireBullet","linearVelocity","applyForceToCenter","callBack","bullet","setPosition","resetSystem","active","tweenMove","stop","to","easing","delay","call","reset","start","stopSystem"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, tween, v3, Vec3, ParticleSystem2D, RigidBody2D, Vec2 } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Player')\nexport class Player extends Component {\n\n    @property(Node)\n    bullet: Node;\n\n    tweenMove: any;\n    rigidBody: RigidBody2D;\n    onLoad() {\n        this.node.on(\"FIRE_TO_POS\", this.fireToPosition, this);\n        this.rigidBody = this.node.getComponent(RigidBody2D);\n    }\n    update(dt) {\n\n    }\n\n    fireToPosition(position) {\n        const nodePos = this.node.getPosition();\n        const currentPos = new Vec2(nodePos.x - position.x, nodePos.y - position.y);\n        const currentAngle = Math.atan2(currentPos.y, currentPos.x) * 180 / Math.PI;\n        const x = this.force * Math.cos((currentAngle * Math.PI) / 180);\n        const y = this.force * Math.sin((currentAngle * Math.PI) / 180);\n\n        this.fireBullet(position);\n        this.rigidBody.linearVelocity = new Vec2(0, 0);\n        this.rigidBody.applyForceToCenter(new Vec2(x, y), true);\n    }\n\n    fireBullet(position, callBack = null) {\n        this.bullet.setPosition(this.node.getPosition());\n        this.bullet.getComponent(ParticleSystem2D).resetSystem();\n        this.bullet.active = true;\n        this.tweenMove && this.tweenMove.stop();\n        this.tweenMove = tween(this.bullet)\n            .to(0.3, { position: v3(position) }, { easing: 'sineInOut' })\n            .delay(0.1)\n            .call(() => {\n                callBack && callBack();\n                this.reset();\n                this.tweenMove = null;\n            })\n            .start();\n    }\n    reset() {\n        this.bullet.getComponent(ParticleSystem2D).resetSystem();\n        this.bullet.getComponent(ParticleSystem2D).stopSystem();\n    }\n}\n"]}